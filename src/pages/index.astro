---
import BaseLayout from "../layouts/BaseLayout.astro";
import Hero from "../components/Hero.astro";
import BlogPostCard from "../components/BlogPostCard.astro";
import { getCollection } from "astro:content";

const allProjects = (await getCollection("projects"))
  .sort((a, b) => a.data.sortOrder - b.data.sortOrder);

const recentPosts = (await getCollection("blog", ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<BaseLayout
  title="Tom Hwang â€” Data by Day, Builder by Night"
  description="By day I crunch national-level data. By night I build what's missing. The best way to understand a problem is to build the solution."
  hideHeader
>
  <Hero />

  <!-- Things I've built -->
  <section class="max-w-3xl mx-auto px-6 py-20">
    <h2 class="text-xs font-medium uppercase tracking-widest text-surface-400 dark:text-surface-500 mb-8">Things I've built</h2>

    <ul class="space-y-6">
      {allProjects.map((project) => (
        <li class="group">
          <div class="flex items-baseline justify-between gap-4">
            <div>
              {project.data.liveUrl ? (
                <a
                  href={project.data.liveUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-base font-semibold text-surface-900 dark:text-surface-100 group-hover:text-accent-600 dark:group-hover:text-accent-400 transition-colors"
                >
                  {project.data.title}
                  <span class="inline-block ml-1 text-surface-400 dark:text-surface-500 group-hover:text-accent-600 dark:group-hover:text-accent-400">&nearr;</span>
                </a>
              ) : (
                <span class="text-base font-semibold text-surface-900 dark:text-surface-100">
                  {project.data.title}
                </span>
              )}
              <p class="mt-1 text-sm text-surface-500 dark:text-surface-400 leading-relaxed">
                {project.data.description}
              </p>
            </div>
          </div>
        </li>
      ))}
    </ul>
  </section>

  <!-- Recent Blog Posts -->
  <section class="max-w-3xl mx-auto px-6 py-20">
    <div class="flex items-end justify-between mb-10">
      <div>
        <p class="text-xs font-medium uppercase tracking-widest text-surface-400 dark:text-surface-500 mb-2">Writing</p>
        <h2
          class="text-2xl font-bold text-surface-900 dark:text-surface-100 tracking-tight"
        >
          Recent thoughts
        </h2>
      </div>
      <a
        href="/blog"
        class="text-sm font-medium text-surface-500 dark:text-surface-400 hover:text-accent-600 dark:hover:text-accent-400 transition-colors"
      >
        View all &rarr;
      </a>
    </div>
    <div class="divide-y divide-surface-200 dark:divide-surface-800">
      {recentPosts.map((post) => <BlogPostCard post={post} />)}
    </div>
  </section>
</BaseLayout>
