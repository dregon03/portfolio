---
import BaseLayout from "../layouts/BaseLayout.astro";
import Hero from "../components/Hero.astro";
import ProjectCard from "../components/ProjectCard.astro";
import BlogPostCard from "../components/BlogPostCard.astro";
import { getCollection } from "astro:content";

const featuredProjects = (await getCollection("projects"))
  .filter((p) => p.data.featured)
  .sort((a, b) => a.data.sortOrder - b.data.sortOrder);

const recentPosts = (await getCollection("blog", ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<BaseLayout
  title="Tom Hwang â€” Data by Day, Builder by Night"
  description="By day I crunch national-level data. By night I build what's missing. The best way to understand a problem is to build the solution."
  hideHeader
>
  <Hero />

  <!-- Featured Projects -->
  <section class="max-w-5xl mx-auto px-6 py-20">
    <div class="flex items-end justify-between mb-10">
      <div>
        <p class="text-xs font-medium uppercase tracking-widest text-surface-400 dark:text-surface-500 mb-2">Projects</p>
        <h2
          class="text-2xl font-bold text-surface-900 dark:text-surface-100 tracking-tight"
        >
          Things I've built
        </h2>
      </div>
      <a
        href="/projects"
        class="text-sm font-medium text-surface-500 dark:text-surface-400 hover:text-accent-600 dark:hover:text-accent-400 transition-colors"
      >
        View all &rarr;
      </a>
    </div>
    <div class="grid gap-6 md:grid-cols-2">
      {featuredProjects.map((project) => <ProjectCard project={project} />)}
    </div>
  </section>

  <!-- Recent Blog Posts -->
  <section class="max-w-3xl mx-auto px-6 py-20">
    <div class="flex items-end justify-between mb-10">
      <div>
        <p class="text-xs font-medium uppercase tracking-widest text-surface-400 dark:text-surface-500 mb-2">Writing</p>
        <h2
          class="text-2xl font-bold text-surface-900 dark:text-surface-100 tracking-tight"
        >
          Recent thoughts
        </h2>
      </div>
      <a
        href="/blog"
        class="text-sm font-medium text-surface-500 dark:text-surface-400 hover:text-accent-600 dark:hover:text-accent-400 transition-colors"
      >
        View all &rarr;
      </a>
    </div>
    <div class="divide-y divide-surface-200 dark:divide-surface-800">
      {recentPosts.map((post) => <BlogPostCard post={post} />)}
    </div>
  </section>
</BaseLayout>
